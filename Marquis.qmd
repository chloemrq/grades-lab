---
title: "Marquis"
author: "Chloé Marquis"
format: 
  html: default
  pdf: default

---

Link to my github repository : https://github.com/chloemrq/grades-lab


```{r}
library(here)
here::i_am("Chloé Marquis.Rproj")
```

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(vroom)
library(lubridate)
```
### Question 1
```{r}
courses <- vroom(here("courses.csv"))
```
### Question 2
```{r}
courses <- courses |>
rename(
  `course name` = course,
  identifier = course_id,
  trimester = trimester,
  `number of exams` = nb_grades
)

courses |>
  arrange(`course name`) |>
  knitr::kable()
```
### Question 3
```{r}
students <- vroom("students.csv",
                   col_types = vroom::cols(
                     id = vroom::col_integer(),
                     group = vroom::col_factor(),
                     birth_date = vroom::col_date(format = "%Y-%m-%d"),
                     sex = vroom::col_factor(levels = c("F", "M"))
                     )
)

# check 
sapply(students, class) # OK
```


### Question 4
```{r}
grades <- vroom(
  here("grades.csv"), 
  delim = ":",
  na = "unknown")
```
### Question 5
```{r}
students |>
  count(group) |>              
  ggplot(aes(x = group, y = n)) +
  geom_col() +
  labs(
    title = "Number of students per group",
    x = "Group",
    y = "Number of students"
)
```

### Question 6
```{r}
students |>
  count(group, sex) |>              
  ggplot(aes(x = group, y = n, fill= sex)) +
  geom_col() +
  labs(
    title = "Number of students per group",
    x = "Group",
    y = "Number of students",
    fill = "Sex"
)
```
The number of women and men in each groups appears to be evenly distributed.

### Question 7
```{r}
students |>
  mutate(age = time_length(today() - birth_date, unit = "year")) |>
    ggplot(aes(x = age)) +
    geom_histogram(binwidth=1) +       
    labs(
      title = "Age distribution",
      x = "Age",
      y = "Number of students"
    )
```
Most students are between 20 and 25, few are older. 

### Question 8
```{r}

# adding an age column
students <- students |>
  mutate(age = round(time_length(today() - birth_date, unit = "year")))

students |>
  group_by(group) |>
  summarise(
    median_age = round(median(age, na.rm = TRUE))) |>
  arrange(group) |>
  knitr::kable()
```


### Question 9
```{r}
students |>
  group_by(group) |>
  slice_max(age, n=1, with_ties = FALSE) |>
  select(id, sex, age) |>
  arrange(desc(age)) |>
  knitr::kable()
```

### Question 10
```{r}
num_grades <- sum(!is.na(grades$grade))
```
The data set contains `r num_grades` grades.

### Question 11
```{r}
# first merge the grades and students dataset to have grades and group in the same data set 
grades_with_group <- grades |>
  left_join(students, by = "id")

avg_bio <- grades_with_group |>
  filter(course_id == 3) |>  # code for this course is 3 (from the courses data set)
  group_by(group) |>
  summarise(
    avg_grade = mean(grade, na.rm = TRUE)  
  )

ggplot(avg_bio, aes(x = factor(group), y = avg_grade)) +
  geom_col() +  
  labs(
    title = "Average grade in Bioengineering and Genetic Modification",
    x = "Group",
    y = "Average grade"
  )
```
There is not much deviations in average grades for this course. 

### Question 12
```{r}
# need to join courses and grades to get the grades per trimester 
grades_per_trimester <- grades |>
  left_join(courses |> select(identifier, trimester), 
            by = c("course_id" = "identifier"))


ggplot(grades_per_trimester, aes(x = grade, color = factor(trimester), fill = factor(trimester))) +
  geom_density(alpha=0.3) +
  labs(
    title = "Density plot of grades per trimester",
    x = "Grade",
    y = "Density",
    color = "Trimester",
    fill = "Trimester"
  )
```
We can see that grades for trimester 2 are lower. While grades for trimesters one and three more similar on average. Grades for trimester 1 are more concentrated around the mean while there is more variation for the third trimester. 

### Question 13
```{r}
grades_per_student <- grades |>
  group_by(id) |>
  summarise(num_grades = sum(!is.na(grade))) |>  
  left_join(students |> select(id, group, sex), by = "id") |>
  select(id, group, sex, num_grades) |>
  arrange(id) 

grades_per_student |>
  slice_head(n = 5) |>     
  knitr::kable()

grades_per_student |>
  summarise(
    minimum = min(num_grades),
    maximum = max(num_grades),
    average = round(mean(num_grades), 2),
    median = median(num_grades)) |> 
  knitr::kable()
```

### Question 14
```{r}
grades_per_student |> 
  ggplot(aes(x = sex, y = num_grades, fill = sex)) +
  geom_boxplot() +
  labs(
    title = "Distribution of number of Grades by sex",
    x = "Sex",
    y = "Number of grades"
  )
```
The number of grades is the same between women and men. 

### Question 15
```{r}
grades_with_group <- grades_with_group |>
  left_join(
    grades_per_student |> select(id, num_grades),
    by = "id"
  )

corp_espionage_ds <- grades_with_group |>
  filter(course_id == 9) |>      
  group_by(id, group, sex) |>
  summarise(num_grades = n(), .groups = "drop") |>
  arrange(id)

corp_espionage_ds |>
  slice_head(n = 5) |>      
  knitr::kable()
```

### Question 16
```{r}
corp_espionage_ds |>
  count(num_grades) |>  
  arrange(num_grades) |>
  ggplot(aes(x = factor(num_grades), y = n)) +
  geom_col() +   
  labs(
    title = "Distribution of Number of Grades per Student in Corporate Espionage and Industrial Sabotage",
    x = "Number of Grades",
    y = "Number of Students"
  )
```
There are a lot more students with 10 grades than any other number of grades. Only a few with 8 or 9 grades. 

### Question 17
```{r}
ggplot(corp_espionage_ds, aes(x = factor(group), y = num_grades)) +
  geom_boxplot() +
  labs(
    title = "Number of grades per student by Group Corporate Espionage and Industrial Sabotage",
    x = "Group",
    y = "Number of grades"
  )
```
The distribution of the number of grades ranges between 9 and 10 grades, with a lot of groups having 0 grades. 

### Question 18
```{r}
ggplot(corp_espionage_ds, aes(x = factor(group), y = num_grades, fill = sex)) +
  geom_boxplot(position = position_dodge(width = 0.8)) +  
  labs(
    title = "Number of Grades per Student by Group and Sex",
    x = "Group",
    y = "Number of Grades",
    fill = "Sex"
  )
```
The distribution of the number of grades is very similar between women and men.

### Question 19
```{r}
avg_grades <- grades |>
  group_by(id, course_id) |>
  summarise(avg_grade = round(mean(grade, na.rm = TRUE), 2), .groups = "drop") |>
  left_join(courses |> select(identifier, `course name`), by = c("course_id" = "identifier")) |>
  left_join(students |> select(id, group), by = "id")

grades_wide <- avg_grades |>
  select(id, group, `course name`, avg_grade) |>
  pivot_wider(
    names_from = `course name`,
    values_from = avg_grade
  )

grades_wide |> 
  select(id, group, 
         `Artificial Intelligence and Machine Learning`,
         `Bioengineering and Genetic Modification`) |>
  slice_head(n = 5) |>
  knitr::kable()
```

### Question 20
```{r}
grades_plot <- grades_wide |>
  select(
    id,
    `Hacking and Network Security`,
    `Neurotechnology and Mind Control`
  ) |>
  filter(
    !is.na(`Hacking and Network Security`) & 
    !is.na(`Neurotechnology and Mind Control`)
  )

ggplot(grades_plot, aes(
  x = `Neurotechnology and Mind Control`,
  y = `Hacking and Network Security`
)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.7) +  
  geom_smooth(method = "lm", color = "red", se = TRUE) +     
  labs(
    title = "Average Grades",
    x = "Average Grade in Neurotechnology and Mind Control",
    y = "Average Grade in Hacking and Network Security"
  )
```
The average grade in hacking is concentrated around 13.5 and doesn't not seem positively or negatively correlated with grades in neurotechnology.

### Question 21
```{r}
grades_corr <- grades_wide |>
  select(
    group,
    `Darknet Culture and Subversive Technologies`,
    `Artificial Intelligence and Machine Learning`
  ) |>
  filter(
    !is.na(`Darknet Culture and Subversive Technologies`) &
    !is.na(`Artificial Intelligence and Machine Learning`)
  )

correlation_by_group <- grades_corr |>
  group_by(group) |>
  summarise(
    correlation = cor(
      `Darknet Culture and Subversive Technologies`,
      `Artificial Intelligence and Machine Learning`
    ),
    .groups = "drop"
  ) |>
  arrange(group) 

correlation_by_group |>
  knitr::kable()
```

### Question 22
```{r}
target_group <- correlation_by_group |>
  slice_max(abs(correlation), n = 1) |>
  pull(group)

grades_target_group <- grades_corr |>
  filter(group == target_group)

ggplot(grades_target_group, aes(
  x = `Artificial Intelligence and Machine Learning`,
  y = `Darknet Culture and Subversive Technologies`
)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(
    title = paste("Grades in Darknet Culture vs AI/ML — Group", target_group),
    x = "Average Grade in Artificial Intelligence and Machine Learning",
    y = "Average Grade in Darknet Culture and Subversive Technologies"
  )
```
There is a negative correlation between the two variables. A lower grade in Darknet culture seems to be associated with a higher grade in artificial intelligence for group 11 (the group for which the grades are the most correlated).


### Question 23
```{r}
final_grades <- grades_wide |>
  mutate(final_grade = rowMeans(across(-c(id, group)), na.rm = TRUE)) |>
  left_join(students |> select(id, sex), by = "id") |>
  select(id, group, sex, final_grade) |>
  arrange(desc(final_grade))

final_grades |> 
  slice_head(n = 5) |>
  knitr::kable()
```

### Question 24
```{r}
ggplot(final_grades, aes(x = factor(group), y = final_grade)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Final Grades by Group",
    x = "Group",
    y = "Final Grade"
  )
```
The overall average final grade is around 11. There is a little variation between groups with the highest average final grade being around 12.3 (group 13) and the lowest being around 10.7 (group 19). Overall, the results are pretty homogneous within and between groups. 


### Question 25
```{r}
ggplot(final_grades, aes(x = factor(group), y = final_grade, fill = sex)) +
  geom_boxplot(position = position_dodge(width = 0.8)) +
  labs(
    title = "Final Grades by Group and Sex",
    x = "Group",
    y = "Final Grade",
    fill = "Sex"
  )
```
We can observe here the variations within groups also including the effect of sex. There is little variation between women and men within groups and between groups. We do not observe a general trend of women scoring always higher than men or the reverse. 

### Question 26
```{r}
grades_wide <- grades_wide |>
  rowwise() |>
  mutate(final_grade = mean(c_across(-c(id, group)), na.rm = TRUE)) |>
  ungroup()

grades_long <- grades_wide |>
  pivot_longer(
    cols = -c(id, group, final_grade),
    names_to = "course_name",
    values_to = "avg_grade"
  )

grades_long <- grades_long |>
  left_join(courses |> select(`course name`, trimester),
            by = c("course_name" = "course name"))

trimester_avg <- grades_long |>
  group_by(id, trimester) |>
  summarise(trimester_avg = mean(avg_grade, na.rm = TRUE), .groups = "drop")

pass_df <- grades_long |>
  group_by(id, group, final_grade) |>
  summarise(min_course = min(avg_grade, na.rm = TRUE), .groups = "drop") |>
  left_join(
    trimester_avg |> group_by(id) |> summarise(min_trimester = min(trimester_avg), .groups = "drop"),
    by = "id"
  ) |>
  mutate(pass = min_course >= 5 & min_trimester >= 10) |>
  select(id, group, final_grade, pass) |>
  arrange(desc(final_grade))

pass_df |> slice_head(n = 10) |> knitr::kable()


```
This is wrong but I'll still use it for the next questions. 

### Question 27
```{r}
students_fail_high <- pass_df |>
  filter(pass == FALSE, final_grade >= 10)

num_fail_high <- nrow(students_fail_high)
```

cat("The number of students who do not pass yet have a final grade >= 10 is", num_fail_high, ".\n")


### Question 28
```{r}
pass_rate_group <- pass_df |>
  group_by(group) |>
  summarise(
    total_students = n(),
    passed = sum(pass),
    pass_rate = passed / total_students,
    .groups = "drop"
  )

ggplot(pass_rate_group, aes(x = factor(group), y = pass_rate)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(
    title = "Pass Rate per Group",
    x = "Group",
    y = "Pass Rate"
  )
```

### Question 29
```{r}
grades_below_5 <- grades_long |>
  filter(avg_grade < 5)

course_failures <- grades_below_5 |>
  group_by(course_name) |>
  summarise(num_failures = n(), .groups = "drop") |>
  arrange(desc(num_failures))

course_failures |> slice_head(n = 1) |> knitr::kable()

```

### Question 30
```{r}
students_age <- students |>
  mutate(age = round(time_length(today() - birth_date, unit = "year")))

pass_age <- pass_df |>
  left_join(students_age |> select(id, age), by = "id")

success_rate_age <- pass_age |>
  group_by(age) |>
  summarise(
    total = n(),
    passed = sum(pass),
    success_rate = passed / total,
    .groups = "drop"
  )

ggplot(success_rate_age, aes(x = age, y = success_rate)) +
  geom_col(fill = "steelblue") +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  labs(
    title = "Student Success Rate by Age",
    x = "Age",
    y = "Success Rate (%)"
  ) +
  theme_minimal(base_size = 14)

```
This is still impacted by question 26, and is therefore not interpretable. 
